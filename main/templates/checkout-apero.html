{% extends "base.html" %}
{% load static %}
{% block content %}
<main class='checkout-bg'>
    <div class="container">
        <div class="product-image-banner">
            <div class="product-text-banner">
                <h1>LIVRAISON - APERO</h1>
                <p>Informations personnelles</p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8 mb-4">
                <div class="card">
                    <form method="POST" class="card-body" novalidate>
                        {% csrf_token %}
                        <h3>Informations personnelles</h3>
                        <!-- {{ form.non_field_errors }} -->

                        <!-- {% if default_address %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="user-save" style="padding: 25px">
                                    <input type="checkbox" class="custom-control-input" name="use_default_shipping"
                                        id="use_default_shipping">
                                    <label class="custom-control-label" for="use_default_shipping">Utiliser vos
                                        informations
                                        personnelles:

                                    </label>

                                </div>

                            </div>
                        </div>

                        {% endif %} -->



                        <div class='hideable_shipping_form'>

                            <div class="row mb-4">
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2">
                                        {{ form.prenom.label_tag }}
                                        {{ form.prenom }}
                                        {{ form.prenom.errors }}
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2 ">
                                        {{ form.name.label_tag }}
                                        {{ form.name }}
                                        {{ form.name.errors }}
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2">
                                        {{ form.email.label_tag }}
                                        {{ form.email }}
                                        {{ form.email.errors }}
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2">
                                        {{ form.phone.label_tag }}
                                        {{ form.phone }}
                                        {{ form.phone.errors }}
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2">
                                        {{ form.code_postal.label_tag }}
                                        {{ form.code_postal }}
                                        {{ form.code_postal.errors }}
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-6">
                                    <div class="md-form mb-2">
                                        {{ form.pays.label_tag }}
                                        {{ form.pays }}
                                        {{ form.pays.errors }}
                                    </div>
                                </div>
                                <div class="col-xs-12">
                                    <div class="md-form mb-2 ml-3">
                                        <div>
                                            {{ form.save_address }}
                                            <label for="" class="">Sauvegarder ces informations pour une prochaine
                                                commande</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <h3>Date de livraison</h3> <br>
                        <div class="row">
                            <div class="col">

                                {{ form.date_delivery }}
                                {{ form.date_delivery.errors }}
                                <div class="help-text-form">
                                    <span><img src="{% static '../static/images/warning.svg' %}" alt="attention"
                                            style="height: 30px;"></span>
                                    <p>Le lieu de livraison se situe sur notre corps Morts. Veuillez regarder la carte
                                        ci-dessous
                                    </p>
                                </div>
                                <br>
                                <div id='map-apero' style='width: 100%; height: 340px;'></div>
                            </div>
                        </div>
                        <hr class="mb-4">
                        <button class="btn-valider btn-lg btn-block" type="submit">Valider la commande</button>

                    </form>
                </div>




            </div>
            <div class="col-md-4 mb-4">
                <div id='stickycart' class="col-md-12 mb-4 mt-5 ">
                    {% include 'order-snippet.html' %}
                    <a class='btn-valider float-right mt-2' href="{% url 'order-summary-apero' %}">
                        Modifier votre panier</a>
                </div>
            </div>

        </div>

    </div>

    </div>
</main>

{% endblock content %}

{% block extra_scripts %}

<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoib2RpbGVsZWNsZXJjc2l0ZSIsImEiOiJjazZjMDJtNGEwZ3F2M2tvdnNncnkxNXRxIn0.c7i8XUNby5CQwhdrsG3r0A';
    var map = new mapboxgl.Map({
        container: 'map-apero',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-1.249550, 44.651470], //longitude, latitude
        zoom: 11,
    });


    var geojson = {
        type: 'FeatureCollection',
        features: [{
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: [-1.2449717, 44.646565,]
            },
            properties: {
                title: 'Point fixe',
                description: 'Livraison apero: Corps morts'
            }

        }]
    };


    // add markers to map
    geojson.features.forEach(function (marker) {

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker';

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
            .addTo(map);
    });
</script>

<script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>

<script>

    $(document).ready(function () {

        flatpickr('#datepicker-apero', {
            // defaultDate: new Date().fp_incr(1),
            minDate: new Date().fp_incr(1),
            dateFormat: "d/m/Y H:i",
            altFormat: "d/m/Y H:i",
            defaultTime: '17:00',
            minTime: '17:00',
            maxTime: '18:00',
            enableTime: true,
            time_24hr: true,
            minuteIncrement: '10',
            locale: "fr",
        })
    });

</script>
<script>
    var hideable_shipping_form = $('.hideable_shipping_form');


    var use_default_shipping = document.querySelector("input[name=use_default_shipping]");

    use_default_shipping.addEventListener('change', function () {
        if (this.checked) {
            // $("#id_prenom").val('{{ default_address.prenom }}');
            // $("#id_name").val('{{ default_address.name }}');
            // $("#id_email").val('{{ default_address.email }}');
            // $("#id_phone").val('{{ default_address.phone }}');
            // $("#id_code_postal").val('{{ default_address.code_postal }}');
            // $("#id_pays").val('{{ default_address.pays }}');

            hideable_shipping_form.hide();
            // $("#id_prenom").prop('required', false);
            // $("#id_name").prop('required', false);
            // $("#id_email").prop('required', false);
            // $("#id_phone").prop('required', false);
            // $("#id_code_postal").prop('required', false);
            // $("#id_pays").prop('required', false);
        } else {
            $("#id_prenom").prop('required', true);
            $("#id_name").prop('required', true);
            $("#id_email").prop('required', true);
            $("#id_phone").prop('required', true);
            $("#id_code_postal").prop('required', true);
            $("#id_pays").prop('required', true);

            hideable_shipping_form.show();
        }
    })
</script>


{% endblock extra_scripts %}